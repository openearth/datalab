{% extends "base.html" %}
{% load i18n l10n static %}

{% block title %}
    {% trans "Detail" %}
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">{% trans "Job details" %}</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    {% trans "Details" %}
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <table class="table table-hover" id="job-detail-table">
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Environment" %}</label></th>
                            <td class="col-sm-9"><a
                                    href="{% url 'environment_detail' object.environment.id %}">{{ object.environment|title }}</a>
                            </td>
                        </tr>
                         <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Script" %}</label></th>
                            <td class="col-sm-9">{{ object.environment.get_repo_url }}scripts/{{ object.script }}</td>
                        </tr>
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "UUID" %}</label></th>
                            <td class="col-sm-9">{{ object.uuid }}</td>
                        </tr>
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Status" %}</label></th>
                            <td class="col-sm-9" id="job-status-field">{{ object.get_status_display|title }}</td>
                        </tr>
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Scheduled start" %}</label></th>
                            <td class="col-sm-9">{{ object.start|date:"d-m-Y H:i:s" }}</td>
                        </tr>
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Created" %}</label></th>
                            <td class="col-sm-9">{{ object.created_date|date:"d-m-Y H:i:s" }}</td>
                        </tr>
                        <tr>
                            <th class="col-sm-3"><label class="control-label" for="">{% trans "Auto Commit" %}</label></th>
                            <td class="col-sm-9">{{ object.auto_commit|yesno }}</td>
                        </tr>
                        <tr style="display: none">
                            <th>{% trans 'Progress' %}</th>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar" id="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                                         aria-valuemax="100" style="width: 0;">
                                    </div>
                                </div>
                                <p class="help-block" id="progress-bar-message"></p>
                            </td>
                        </tr>
                    </table>
                    <button type="button" class="btn btn-primary"
                            id="preform-job-action"
                            data-job-id="{{ object.uuid }}"
                            data-env-id="{{ object.environment.id }}"
                            data-action="stop_job" {% if object.status >= 100 %}disabled{% endif %}>
                        {% if object.status <= 100 %}
                            {% trans 'revoke job' %}
                        {% else %}
                            {% trans 'oops' %}
                        {% endif %}
                    </button>
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>

    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <div class="checkbox pull-right" style="margin:4px 0">
                        <label>
                            <input id="cb_scrolldown_first" class="cb_scrolldown" type="checkbox"> Scroll down
                        </label>
                    </div>
                    <span class="fa-stack">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
                    </span>
                    {% trans "Processing" %}
                    <div class="clearfix"></div>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <ul class="nav nav-tabs nav-justified">
                        <li class="{% if not object.results %}active{% endif %}"><a href="#terminal-tab" data-toggle="tab">Log</a>
                        </li>
                        <li class="{% if object.results %}active{% endif %}"><a href="#results-tab" data-toggle="tab">Results</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade {% if not object.results %}active in{% endif %}" id="terminal-tab"><pre id="terminal" data-ws-url="{{ ws_url }}"></pre></div>
                        <div class="tab-pane fade {% if object.results %}active in{% endif %}" id="results-tab">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>{% trans "Filename" %}</th>
                                        <th>{% trans "Committed ?" %}</th>
                                        <th>{% trans "Sha1 Hash" %}</th>
                                        <th>&nbsp;</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for result in object.processing_result.all %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td><a href="{{ result.file.url }}">{{ result.file }}</a></td>
                                        <td>{{ result.committed|yesno }}</td>
                                        <td>{{ result.file.sha1 }}</td>
                                        <td><a href="{{ result.file.url }}" title="{% trans "Download" %}"><i class="fa fa-download fa-fw"></i></a></td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="3">{% trans 'No results found' %}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- /.panel-body -->
                <div class="panel-footer">
                    <div class="checkbox pull-right" style="margin:4px 0">
                        <label>
                            <input class="cb_scrolldown" type="checkbox"> Scroll down
                        </label>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <!-- /.panel-footer -->
            </div>
            <!-- /.panel -->
        </div>

    </div>
    <!-- /.row -->
{% endblock %}

{% block extra-bottom-slot %}
    <script src="{% static "js/processing.js" %}"></script>
{% endblock %}

